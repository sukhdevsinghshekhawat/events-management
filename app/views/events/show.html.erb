<h2><%= @event.title %></h2>
<p><strong>Venue:</strong> <%= @event.venue %></p>
<p><strong>Date:</strong> <%= @event.date %></p>
<p><strong>Time:</strong> <%= @event.start_time.strftime("%H:%M") %> - <%= @event.end_time.strftime("%H:%M") %></p>
<p><strong>Teacher:</strong> <%= @event.teacher.name %></p>
<p><%= @event.description %></p>

<% if logged_in? && current_user.role == "student" %>
  <% if @event.students.include?(current_user) %>
    <%= button_to "Cancel Registration", event_registration_path(@event, @registration), method: :delete, class: "btn btn-warning" %>
  <% else %>
    <%= link_to "Register", new_event_registration_path(@event), class: "btn btn-primary" %>  
  <% end %>

<% end %>

<% if logged_in? && current_user.role == "admin" %>
  <%= link_to "Edit Event", edit_event_path(@event), class: "btn btn-warning mt-2" %>
  <%= link_to "Delete Event", event_path(@event), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-danger mt-2" %>
  <%= link_to "View Participants", event_registrations_path(@event), class: "btn btn-info mt-2" %>
<% end %>

<hr>

<% if logged_in? && current_user.role == "admin" %>
  <%= render "announcements/form", event: @event %>
<% end %>

<div id="announcements" data-event-id="<%= @event.id %>">
  <% @event.announcements.order(created_at: :desc).each do |a| %>
    <p><strong><%= a.user.name %>:</strong> <%= a.message %> <span class="text-muted" style="font-size:0.9em">(<%= a.created_at.strftime("%H:%M") %>)</span></p>
  <% end %>
</div>

<hr>

<%= render "messages/form", event: @event if logged_in? %>

<div id="messages" data-event-id="<%= @event.id %>">
  <% @event.messages.order(created_at: :asc).each do |m| %>
    <p><strong><%= m.user.name %>:</strong> <%= m.content %> <span class="text-muted" style="font-size:0.9em">(<%= m.created_at.strftime("%H:%M") %>)</span></p>
  <% end %>
</div>
